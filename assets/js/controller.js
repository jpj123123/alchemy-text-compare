var ALCHEMY_API_URL = "http://access.alchemyapi.com/calls/"
  , ALCHEMY_API_KEY = "35857293ebb9f7309de666daa8b04ecb1977ef9e"

angular.module('alchemy',[])
.config(function($httpProvider){
    delete $httpProvider.defaults.headers.common['X-Requested-With'];
})
.controller('split', function($scope, $http) {
    $(document).ready(function() {
      $("[tabindex=1]").focus().select() // focus on URL 1
    })
    /* -----
    | Config
    */

    _.templateSettings.interpolate = /{{([\s\S]+?)}}/g;

    $scope.nPages = 2;
    $scope.metrics = [
        { name: "entities", endpoint: "url/URLGetRankedNamedEntities" },
        { name: "keywords", endpoint: "url/URLGetRankedKeywords" },
        { name: "concepts", endpoint: "url/URLGetRankedConcepts" },
        { name: "relations", endpoint: "url/URLGetRelations" }
    ]

    $scope.getNumber = function(num) {
        return new Array(num);
    }
    $scope.page = [{"url":"http://en.wikipedia.org/wiki/Refrigerator","data":{"keywords":{"raw":[{"relevance":"0.966506","text":"refrigerator","$$hashKey":"object:23"},{"relevance":"0.829055","text":"refrigerators","$$hashKey":"object:24"},{"relevance":"0.698825","text":"freezer","$$hashKey":"object:25"},{"relevance":"0.697456","text":"refrigerator compartment","$$hashKey":"object:26"},{"relevance":"0.636261","text":"freezer compartment","$$hashKey":"object:27"},{"relevance":"0.590423","text":"large domestic refrigerator","$$hashKey":"object:28"},{"relevance":"0.586483","text":"commercial refrigerator","$$hashKey":"object:29"},{"relevance":"0.584718","text":"domestic refrigerator stands","$$hashKey":"object:30"},{"relevance":"0.583122","text":"household refrigerators","$$hashKey":"object:31"},{"relevance":"0.566003","text":"larger refrigerator compartment","$$hashKey":"object:32"},{"relevance":"0.555586","text":"freezer units","$$hashKey":"object:33"},{"relevance":"0.555072","text":"refrigerator section","$$hashKey":"object:34"},{"relevance":"0.554444","text":"domestic refrigerators","$$hashKey":"object:35"},{"relevance":"0.552284","text":"refrigerator market","$$hashKey":"object:36"},{"relevance":"0.552055","text":"Early refrigerator models","$$hashKey":"object:37"},{"relevance":"0.547558","text":"separate freezer compartment","$$hashKey":"object:38"},{"relevance":"0.546522","text":"absorption refrigerator","$$hashKey":"object:39"},{"relevance":"0.545784","text":"Peltier refrigerator","$$hashKey":"object:40"},{"relevance":"0.542562","text":"refrigerator door","$$hashKey":"object:41"},{"relevance":"0.540307","text":"freezer compartment temperature","$$hashKey":"object:42"},{"relevance":"0.5385","text":"main refrigerator compartment","$$hashKey":"object:43"},{"relevance":"0.537638","text":"common commercial refrigerator","$$hashKey":"object:44"},{"relevance":"0.536027","text":"refrigerator temperature","$$hashKey":"object:45"},{"relevance":"0.528519","text":"refrigerator main door","$$hashKey":"object:46"},{"relevance":"0.525865","text":"French-door refrigerator section","$$hashKey":"object:47"},{"relevance":"0.525112","text":"refrigerator door shelves","$$hashKey":"object:48"},{"relevance":"0.519594","text":"compressor refrigerator","$$hashKey":"object:49"},{"relevance":"0.514951","text":"cold refrigerator section","$$hashKey":"object:50"},{"relevance":"0.512951","text":"modern refrigerator","$$hashKey":"object:51"},{"relevance":"0.505884","text":"self-contained refrigerator","$$hashKey":"object:52"},{"relevance":"0.504523","text":"compact refrigerator","$$hashKey":"object:53"},{"relevance":"0.503949","text":"refrigerator compartments","$$hashKey":"object:54"},{"relevance":"0.497511","text":"freezer temperature","$$hashKey":"object:55"},{"relevance":"0.497256","text":"refrigerator interior","$$hashKey":"object:56"},{"relevance":"0.496132","text":"Phoenix refrigerator program","$$hashKey":"object:57"},{"relevance":"0.495091","text":"Newer refrigerators","$$hashKey":"object:58"},{"relevance":"0.492391","text":"typical refrigerator","$$hashKey":"object:59"},{"relevance":"0.491895","text":"refrigerator adjustment","$$hashKey":"object:60"},{"relevance":"0.491537","text":"refrigerator style","$$hashKey":"object:61"},{"relevance":"0.490651","text":"thermal mass refrigerators","$$hashKey":"object:62"},{"relevance":"0.49021","text":"Early freezer units","$$hashKey":"object:63"},{"relevance":"0.490114","text":"refrigerator roll","$$hashKey":"object:64"},{"relevance":"0.485878","text":"Modern refrigerators","$$hashKey":"object:65"},{"relevance":"0.485154","text":"refrigerator doors","$$hashKey":"object:66"},{"relevance":"0.484788","text":"freezer section","$$hashKey":"object:67"},{"relevance":"0.480809","text":"Practical household refrigerators","$$hashKey":"object:68"},{"relevance":"0.477967","text":"Modern computerized refrigerators","$$hashKey":"object:69"},{"relevance":"0.477492","text":"refrigerator fans","$$hashKey":"object:70"},{"relevance":"0.477438","text":"freezer compartments","$$hashKey":"object:71"},{"relevance":"0.473017","text":"absorption refrigerators","$$hashKey":"object:72"}]},"concepts":{"raw":[{"text":"Refrigerator","relevance":"0.97366","dbpedia":"http://dbpedia.org/resource/Refrigerator","freebase":"http://rdf.freebase.com/ns/m.040b_t","opencyc":"http://sw.opencyc.org/concept/Mx4rvViddJwpEbGdrcN5Y29ycA","$$hashKey":"object:123"},{"text":"Refrigeration","relevance":"0.650905","dbpedia":"http://dbpedia.org/resource/Refrigeration","freebase":"http://rdf.freebase.com/ns/m.0cjbx","$$hashKey":"object:124"},{"text":"Vapor-compression refrigeration","relevance":"0.633841","dbpedia":"http://dbpedia.org/resource/Vapor-compression_refrigeration","freebase":"http://rdf.freebase.com/ns/m.0cj3y8","yago":"http://yago-knowledge.org/resource/Vapor-compression_refrigeration","$$hashKey":"object:125"},{"text":"Heat pump","relevance":"0.632824","dbpedia":"http://dbpedia.org/resource/Heat_pump","freebase":"http://rdf.freebase.com/ns/m.0hw90","opencyc":"http://sw.opencyc.org/concept/Mx4rvViUcJwpEbGdrcN5Y29ycA","$$hashKey":"object:126"},{"text":"Absorption refrigerator","relevance":"0.628968","dbpedia":"http://dbpedia.org/resource/Absorption_refrigerator","freebase":"http://rdf.freebase.com/ns/m.07029t","yago":"http://yago-knowledge.org/resource/Absorption_refrigerator","$$hashKey":"object:127"},{"text":"Heat pumps","relevance":"0.421819","dbpedia":"http://dbpedia.org/resource/Heat_pumps","$$hashKey":"object:128"},{"text":"Cooling technology","relevance":"0.416127","dbpedia":"http://dbpedia.org/resource/Cooling_technology","$$hashKey":"object:129"},{"text":"Thermoelectric cooling","relevance":"0.375495","dbpedia":"http://dbpedia.org/resource/Thermoelectric_cooling","freebase":"http://rdf.freebase.com/ns/m.01t3zc","$$hashKey":"object:130"}]},"entities":{"raw":[{"type":"Country","relevance":"0.747757","count":"6","text":"United States","disambiguated":{"subType":["Location","Region","AdministrativeDivision","GovernmentalJurisdiction","FilmEditor"],"name":"United States","website":"http://www.usa.gov/","dbpedia":"http://dbpedia.org/resource/United_States","freebase":"http://rdf.freebase.com/ns/m.09c7w0","ciaFactbook":"http://www4.wiwiss.fu-berlin.de/factbook/resource/United_States","opencyc":"http://sw.opencyc.org/concept/Mx4rvVikKpwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/United_States"},"$$hashKey":"object:269"},{"type":"Company","relevance":"0.737638","count":"4","text":"Freon","disambiguated":{"name":"Frémok","dbpedia":"http://dbpedia.org/resource/Frémok","freebase":"http://rdf.freebase.com/ns/m.06h_64"},"$$hashKey":"object:270"},{"type":"Company","relevance":"0.589069","count":"2","text":"Frigidaire","disambiguated":{"subType":[],"name":"Frigidaire","dbpedia":"http://dbpedia.org/resource/Frigidaire","freebase":"http://rdf.freebase.com/ns/m.043rxp","yago":"http://yago-knowledge.org/resource/Frigidaire"},"$$hashKey":"object:271"},{"type":"Company","relevance":"0.562764","count":"4","text":"General Foods","disambiguated":{"subType":["Brand"],"name":"General Foods","dbpedia":"http://dbpedia.org/resource/General_Foods","freebase":"http://rdf.freebase.com/ns/m.04k63j","opencyc":"http://sw.opencyc.org/concept/Mx4rvVjq6JwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/General_Foods"},"$$hashKey":"object:272"},{"type":"FieldTerminology","relevance":"0.546298","count":"3","text":"Energy Efficiency","$$hashKey":"object:273"},{"type":"FieldTerminology","relevance":"0.528259","count":"2","text":"energy consumption","$$hashKey":"object:274"},{"type":"Person","relevance":"0.523906","count":"4","text":"Joseph E. Davies","disambiguated":{"subType":["OfficeHolder","FilmWriter"],"name":"Joseph E. Davies","dbpedia":"http://dbpedia.org/resource/Joseph_E._Davies","freebase":"http://rdf.freebase.com/ns/m.08p5rt","yago":"http://yago-knowledge.org/resource/Joseph_E._Davies"},"$$hashKey":"object:275"},{"type":"Country","relevance":"0.510437","count":"2","text":"Australia","disambiguated":{"subType":["Location","GovernmentalJurisdiction","Kingdom"],"name":"Australia","geo":"-35.3 149.13333333333333","dbpedia":"http://dbpedia.org/resource/Australia","freebase":"http://rdf.freebase.com/ns/m.0chghy","geonames":"http://sws.geonames.org/2077456/","ciaFactbook":"http://www4.wiwiss.fu-berlin.de/factbook/resource/Australia","opencyc":"http://sw.opencyc.org/concept/Mx4rvViUs5wpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Australia"},"$$hashKey":"object:276"},{"type":"FieldTerminology","relevance":"0.508316","count":"4","text":"Energy Star","$$hashKey":"object:277"},{"type":"Person","relevance":"0.49396","count":"2","text":"Carl von Linde","disambiguated":{"subType":["ProjectParticipant"],"name":"Carl von Linde","dbpedia":"http://dbpedia.org/resource/Carl_von_Linde","freebase":"http://rdf.freebase.com/ns/m.03xgmy","yago":"http://yago-knowledge.org/resource/Carl_von_Linde"},"$$hashKey":"object:278"},{"type":"Company","relevance":"0.481041","count":"2","text":"Kelvinator","disambiguated":{"subType":[],"name":"Kelvinator","dbpedia":"http://dbpedia.org/resource/Kelvinator","freebase":"http://rdf.freebase.com/ns/m.043s3f","yago":"http://yago-knowledge.org/resource/Kelvinator"},"$$hashKey":"object:279"},{"type":"Person","relevance":"0.474221","count":"2","text":"James Harrison","disambiguated":{"subType":["Inventor","ProjectParticipant"],"name":"James Harrison (engineer)","dbpedia":"http://dbpedia.org/resource/James_Harrison_(engineer)","freebase":"http://rdf.freebase.com/ns/m.0267ys","yago":"http://yago-knowledge.org/resource/James_Harrison_(engineer)"},"$$hashKey":"object:280"},{"type":"Person","relevance":"0.466982","count":"2","text":"William Cullen","disambiguated":{"subType":["Academic","Scientist"],"name":"William Cullen","dbpedia":"http://dbpedia.org/resource/William_Cullen","freebase":"http://rdf.freebase.com/ns/m.01nbdz","yago":"http://yago-knowledge.org/resource/William_Cullen"},"$$hashKey":"object:281"},{"type":"City","relevance":"0.459705","count":"2","text":"Moscow","disambiguated":{"subType":["AdministrativeDivision","GovernmentalJurisdiction","OlympicHostCity","AwardWinner"],"name":"Moscow","website":"http://www.mos.ru","dbpedia":"http://dbpedia.org/resource/Moscow","freebase":"http://rdf.freebase.com/ns/m.04swd","geonames":"http://sws.geonames.org/524901/","yago":"http://yago-knowledge.org/resource/Moscow"},"$$hashKey":"object:282"},{"type":"Person","relevance":"0.453503","count":"1","text":"Oliver Evans","disambiguated":{"subType":["Inventor"],"name":"Oliver Evans","dbpedia":"http://dbpedia.org/resource/Oliver_Evans","freebase":"http://rdf.freebase.com/ns/m.022k0p","yago":"http://yago-knowledge.org/resource/Oliver_Evans"},"$$hashKey":"object:283"},{"type":"Person","relevance":"0.453471","count":"2","text":"Alfred Mellowes","$$hashKey":"object:284"},{"type":"Person","relevance":"0.450913","count":"1","text":"John Gorrie","disambiguated":{"subType":[],"name":"John Gorrie","dbpedia":"http://dbpedia.org/resource/John_Gorrie","freebase":"http://rdf.freebase.com/ns/m.034098","yago":"http://yago-knowledge.org/resource/John_Gorrie"},"$$hashKey":"object:285"},{"type":"Company","relevance":"0.4503","count":"1","text":"Electrolux","disambiguated":{"subType":[],"name":"Electrolux","website":"http://www.electrolux.com","dbpedia":"http://dbpedia.org/resource/Electrolux","freebase":"http://rdf.freebase.com/ns/m.02h0_y","opencyc":"http://sw.opencyc.org/concept/Mx4rwF5bG5wpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Electrolux","crunchbase":"http://www.crunchbase.com/company/electrolux"},"$$hashKey":"object:286"},{"type":"Person","relevance":"0.447595","count":"1","text":"Ferdinand Carré","disambiguated":{"subType":[],"name":"Ferdinand Carré","dbpedia":"http://dbpedia.org/resource/Ferdinand_Carré","freebase":"http://rdf.freebase.com/ns/m.03wbfx4"},"$$hashKey":"object:287"},{"type":"Company","relevance":"0.446946","count":"1","text":"Ford","disambiguated":{"subType":["AutomobileCompany","AwardWinner","Inventor","SchoolFounder"],"name":"Ford Motor Company","website":"http://www.ford.com","dbpedia":"http://dbpedia.org/resource/Ford_Motor_Company","freebase":"http://rdf.freebase.com/ns/m.02zs4","yago":"http://yago-knowledge.org/resource/Ford_Motor_Company","crunchbase":"http://www.crunchbase.com/company/ford-motor-company"},"$$hashKey":"object:288"},{"type":"JobTitle","relevance":"0.438447","count":"2","text":"professor","$$hashKey":"object:289"},{"type":"JobTitle","relevance":"0.436878","count":"2","text":"engineer","$$hashKey":"object:290"},{"type":"Country","relevance":"0.436763","count":"1","text":"USSR","disambiguated":{"subType":["Location","GovernmentalJurisdiction"],"name":"Soviet Union","dbpedia":"http://dbpedia.org/resource/Soviet_Union","freebase":"http://rdf.freebase.com/ns/m.05vz3zq","opencyc":"http://sw.opencyc.org/concept/Mx4rvVjPzpwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Soviet_Union"},"$$hashKey":"object:291"},{"type":"Country","relevance":"0.425936","count":"1","text":"France","disambiguated":{"subType":["Location","Region","AdministrativeDivision","GovernmentalJurisdiction","FilmDirector"],"name":"France","geo":"47.0 2.0","website":"http://www.service-public.fr/etranger/english.html","dbpedia":"http://dbpedia.org/resource/France","freebase":"http://rdf.freebase.com/ns/m.0f8l9c","ciaFactbook":"http://www4.wiwiss.fu-berlin.de/factbook/resource/France","opencyc":"http://sw.opencyc.org/concept/Mx4rvVj6EJwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/France"},"$$hashKey":"object:292"},{"type":"Drug","relevance":"0.425027","count":"1","text":"diethyl ether","$$hashKey":"object:293"},{"type":"Organization","relevance":"0.420372","count":"2","text":"European Union","disambiguated":{"subType":["Location","Country","GovernmentalJurisdiction","MembershipOrganization","AwardWinner"],"name":"European Union","dbpedia":"http://dbpedia.org/resource/European_Union","freebase":"http://rdf.freebase.com/ns/m.02jxk","ciaFactbook":"http://www4.wiwiss.fu-berlin.de/factbook/resource/European_Union","opencyc":"http://sw.opencyc.org/concept/Mx4rvViCCZwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/European_Union"},"$$hashKey":"object:294"},{"type":"Person","relevance":"0.420139","count":"1","text":"Charles Tellier","disambiguated":{"subType":["Inventor"],"name":"Charles Tellier","dbpedia":"http://dbpedia.org/resource/Charles_Tellier","freebase":"http://rdf.freebase.com/ns/m.03hkyvh"},"$$hashKey":"object:295"},{"type":"Person","relevance":"0.420093","count":"1","text":"Clarence Birdseye","disambiguated":{"subType":["Inventor"],"name":"Clarence Birdseye","dbpedia":"http://dbpedia.org/resource/Clarence_Birdseye","freebase":"http://rdf.freebase.com/ns/m.04k46c","yago":"http://yago-knowledge.org/resource/Clarence_Birdseye"},"$$hashKey":"object:296"},{"type":"Person","relevance":"0.416674","count":"1","text":"Baltzar von Platen","disambiguated":{"name":"Baltzar von Platen (inventor)","dbpedia":"http://dbpedia.org/resource/Baltzar_von_Platen_(inventor)","freebase":"http://rdf.freebase.com/ns/m.01jhr0","yago":"http://yago-knowledge.org/resource/Baltzar_von_Platen_(inventor)"},"$$hashKey":"object:297"},{"type":"Continent","relevance":"0.416622","count":"1","text":"Europe","disambiguated":{"name":"Europe","dbpedia":"http://dbpedia.org/resource/Europe","freebase":"http://rdf.freebase.com/ns/m.02j9z","yago":"http://yago-knowledge.org/resource/Europe"},"$$hashKey":"object:298"},{"type":"GeographicFeature","relevance":"0.416495","count":"1","text":"Barwon River","disambiguated":{"subType":["Location","BodyOfWater","River"],"name":"Barwon River (Victoria)","geo":"-38.2821 144.4964","dbpedia":"http://dbpedia.org/resource/Barwon_River_(Victoria)","freebase":"http://rdf.freebase.com/ns/m.03kwww","yago":"http://yago-knowledge.org/resource/Barwon_River_(Victoria)"},"$$hashKey":"object:299"},{"type":"Person","relevance":"0.41648","count":"1","text":"Jacob Perkins","disambiguated":{"subType":[],"name":"Jacob Perkins","dbpedia":"http://dbpedia.org/resource/Jacob_Perkins","freebase":"http://rdf.freebase.com/ns/m.077wcm","yago":"http://yago-knowledge.org/resource/Jacob_Perkins"},"$$hashKey":"object:300"},{"type":"Person","relevance":"0.416395","count":"1","text":"Michael Faraday","disambiguated":{"subType":["Academic","AwardWinner","ProjectParticipant","Scientist","Adherents"],"name":"Michael Faraday","dbpedia":"http://dbpedia.org/resource/Michael_Faraday","freebase":"http://rdf.freebase.com/ns/m.04zt0","yago":"http://yago-knowledge.org/resource/Michael_Faraday"},"$$hashKey":"object:301"},{"type":"Person","relevance":"0.41407","count":"1","text":"William C. Durant","disambiguated":{"subType":["CompanyFounder"],"name":"William C. Durant","dbpedia":"http://dbpedia.org/resource/William_C._Durant","freebase":"http://rdf.freebase.com/ns/m.0208tr","yago":"http://yago-knowledge.org/resource/William_C._Durant"},"$$hashKey":"object:302"},{"type":"Country","relevance":"0.412809","count":"1","text":"Mexico","disambiguated":{"subType":["Location","PoliticalDistrict","GovernmentalJurisdiction","FilmCinematographer"],"name":"Mexico","website":"http://www.gob.mx/wb/egobierno/egob_General_Information","dbpedia":"http://dbpedia.org/resource/Mexico","freebase":"http://rdf.freebase.com/ns/m.0b90_r","ciaFactbook":"http://www4.wiwiss.fu-berlin.de/factbook/resource/Mexico","opencyc":"http://sw.opencyc.org/concept/Mx4rvVkAiZwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Mexico"},"$$hashKey":"object:303"},{"type":"FieldTerminology","relevance":"0.411881","count":"1","text":"World War II","$$hashKey":"object:304"},{"type":"Person","relevance":"0.41014","count":"1","text":"Nathaniel B. Wales","disambiguated":{"name":"Nathaniel B. Wales","dbpedia":"http://dbpedia.org/resource/Nathaniel_B._Wales","freebase":"http://rdf.freebase.com/ns/m.0j7jw4t"},"$$hashKey":"object:305"},{"type":"Facility","relevance":"0.40932","count":"1","text":"Fort Wayne","disambiguated":{"subType":["Location","Building"],"name":"Fort Wayne (Detroit)","website":"http://www.detroithistorical.org/aboutus/fortwayne.asp","dbpedia":"http://dbpedia.org/resource/Fort_Wayne_(Detroit)","freebase":"http://rdf.freebase.com/ns/m.06_smv","geonames":"http://sws.geonames.org/4993183/","yago":"http://yago-knowledge.org/resource/Fort_Wayne_(Detroit)"},"$$hashKey":"object:306"},{"type":"City","relevance":"0.408897","count":"1","text":"Detroit","disambiguated":{"name":"Detroit","website":"http://www.detroitmi.gov/","dbpedia":"http://dbpedia.org/resource/Detroit","freebase":"http://rdf.freebase.com/ns/m.02dtg"},"$$hashKey":"object:307"},{"type":"StateOrCounty","relevance":"0.408485","count":"1","text":"Indiana","disambiguated":{"subType":["Location","PoliticalDistrict","AdministrativeDivision","GovernmentalJurisdiction","USState"],"name":"Indiana","geo":"40.0 -86.0","website":"http://www.in.gov","dbpedia":"http://dbpedia.org/resource/Indiana","freebase":"http://rdf.freebase.com/ns/m.03v1s","opencyc":"http://sw.opencyc.org/concept/Mx4rvVi2RJwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Indiana"},"$$hashKey":"object:308"},{"type":"City","relevance":"0.408464","count":"1","text":"Stockholm","disambiguated":{"subType":["Facility","AdministrativeDivision","OlympicBiddingCity","OlympicHostCity"],"name":"Stockholm","website":"http://www.stockholm.se/","dbpedia":"http://dbpedia.org/resource/Stockholm","freebase":"http://rdf.freebase.com/ns/m.06mxs","geonames":"http://sws.geonames.org/2673730/","yago":"http://yago-knowledge.org/resource/Stockholm"},"$$hashKey":"object:309"},{"type":"Organization","relevance":"0.40833","count":"1","text":"Royal Institute of Technology","disambiguated":{"subType":["Location","Facility","Building","CollegeUniversity","University"],"name":"Royal Institute of Technology","geo":"59.34722222222222 18.072777777777777","website":"http://www.kth.se/?l=en_UK","dbpedia":"http://dbpedia.org/resource/Royal_Institute_of_Technology","freebase":"http://rdf.freebase.com/ns/m.06d2z","yago":"http://yago-knowledge.org/resource/Royal_Institute_of_Technology"},"$$hashKey":"object:310"},{"type":"StateOrCounty","relevance":"0.408291","count":"1","text":"Michigan","disambiguated":{"subType":["Location","PoliticalDistrict","AdministrativeDivision","GovernmentalJurisdiction","USState"],"name":"Michigan","website":"http://www.michigan.gov","dbpedia":"http://dbpedia.org/resource/Michigan","freebase":"http://rdf.freebase.com/ns/m.04rrx","yago":"http://yago-knowledge.org/resource/Michigan"},"$$hashKey":"object:311"},{"type":"Country","relevance":"0.407948","count":"1","text":"Sweden","disambiguated":{"subType":["SportsTeam","Location","AdministrativeDivision","GovernmentalJurisdiction","Kingdom"],"name":"Sweden","website":"http://www.sweden.se/","dbpedia":"http://dbpedia.org/resource/Sweden","freebase":"http://rdf.freebase.com/ns/m.0d0vqn","ciaFactbook":"http://www4.wiwiss.fu-berlin.de/factbook/resource/Sweden","opencyc":"http://sw.opencyc.org/concept/Mx4rvVjevpwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Sweden"},"$$hashKey":"object:312"},{"type":"FieldTerminology","relevance":"0.407374","count":"1","text":"petroleum gas","$$hashKey":"object:313"},{"type":"Facility","relevance":"0.405639","count":"1","text":"Spaso House","disambiguated":{"subType":["Location","Building"],"name":"Spaso House","geo":"55.75055555555556 37.588055555555556","dbpedia":"http://dbpedia.org/resource/Spaso_House","freebase":"http://rdf.freebase.com/ns/m.02qyqtc","yago":"http://yago-knowledge.org/resource/Spaso_House"},"$$hashKey":"object:314"},{"type":"Organization","relevance":"0.405259","count":"1","text":"Johns Hopkins University Press","disambiguated":{"subType":["CompanyDivision","PeriodicalPublisher"],"name":"Johns Hopkins University Press","website":"http://www.press.jhu.edu","dbpedia":"http://dbpedia.org/resource/Johns_Hopkins_University_Press","freebase":"http://rdf.freebase.com/ns/m.09xgg5","yago":"http://yago-knowledge.org/resource/Johns_Hopkins_University_Press"},"$$hashKey":"object:315"},{"type":"Company","relevance":"0.405016","count":"1","text":"Amana","$$hashKey":"object:316"},{"type":"Organization","relevance":"0.403903","count":"1","text":"Soviet Union","disambiguated":{"subType":["Location","Country","GovernmentalJurisdiction"],"name":"Soviet Union","dbpedia":"http://dbpedia.org/resource/Soviet_Union","freebase":"http://rdf.freebase.com/ns/m.05vz3zq","opencyc":"http://sw.opencyc.org/concept/Mx4rvVjPzpwpEbGdrcN5Y29ycA","yago":"http://yago-knowledge.org/resource/Soviet_Union"},"$$hashKey":"object:317"},{"type":"Company","relevance":"0.403007","count":"1","text":"Peltier","$$hashKey":"object:318"}]}}},{"url":"http://www.appliancecity.co.uk/products/fridges-and-freezers/","data":{"entities":{"raw":[{"type":"Company","relevance":"0.767101","count":"1","text":"Gorenje","disambiguated":{"subType":[],"name":"Gorenje","website":"http://www.gorenjegroup.com/","dbpedia":"http://dbpedia.org/resource/Gorenje","freebase":"http://rdf.freebase.com/ns/m.04r59s","yago":"http://yago-knowledge.org/resource/Gorenje","crunchbase":"http://www.crunchbase.com/company/gorenje"},"$$hashKey":"object:139"},{"type":"Company","relevance":"0.737061","count":"1","text":"Smeg","$$hashKey":"object:140"},{"type":"Company","relevance":"0.730389","count":"1","text":"Liebherr","disambiguated":{"subType":[],"name":"Liebherr Group","website":"http://www.liebherr.com/lh/en/","dbpedia":"http://dbpedia.org/resource/Liebherr_Group","freebase":"http://rdf.freebase.com/ns/m.07_t2d","yago":"http://yago-knowledge.org/resource/Liebherr_Group"},"$$hashKey":"object:141"},{"type":"Company","relevance":"0.694924","count":"1","text":"Samsung","disambiguated":{"name":"Samsung","dbpedia":"http://dbpedia.org/resource/Samsung","freebase":"http://rdf.freebase.com/ns/m.07gv72"},"$$hashKey":"object:142"},{"type":"Company","relevance":"0.685248","count":"1","text":"Appliance City","$$hashKey":"object:143"},{"type":"Company","relevance":"0.650297","count":"1","text":"LG","disambiguated":{"name":"LG Corp","dbpedia":"http://dbpedia.org/resource/LG_Corp","freebase":"http://rdf.freebase.com/ns/m.04k024"},"$$hashKey":"object:144"},{"type":"Company","relevance":"0.643903","count":"1","text":"Bosch","disambiguated":{"subType":["Brand"],"name":"Robert Bosch GmbH","website":"http://www.Bosch.com","dbpedia":"http://dbpedia.org/resource/Robert_Bosch_GmbH","freebase":"http://rdf.freebase.com/ns/m.01hnkf","opencyc":"http://sw.opencyc.org/concept/Mx4rOpHDAHooEdaQbwCQJ5pcrQ","yago":"http://yago-knowledge.org/resource/Robert_Bosch_GmbH"},"$$hashKey":"object:145"},{"type":"Company","relevance":"0.639357","count":"1","text":"Whirlpool","disambiguated":{"name":"Whirlpool Corporation","website":"http://www.whirlpoolcorp.com/","dbpedia":"http://dbpedia.org/resource/Whirlpool_Corporation","freebase":"http://rdf.freebase.com/ns/m.04d8tw","yago":"http://yago-knowledge.org/resource/Whirlpool_Corporation"},"$$hashKey":"object:146"},{"type":"Company","relevance":"0.631214","count":"1","text":"Neff","$$hashKey":"object:147"},{"type":"Company","relevance":"0.628305","count":"1","text":"Miele","$$hashKey":"object:148"},{"type":"Quantity","relevance":"0.628305","count":"1","text":"15cm","$$hashKey":"object:149"},{"type":"Quantity","relevance":"0.628305","count":"1","text":"60cm","$$hashKey":"object:150"}]},"keywords":{"raw":[{"relevance":"0.986489","text":"fridge freezer","$$hashKey":"object:163"},{"relevance":"0.958813","text":"style fridge freezers","$$hashKey":"object:164"},{"relevance":"0.917007","text":"retro style fridge","$$hashKey":"object:165"},{"relevance":"0.853722","text":"popular integrated fridge","$$hashKey":"object:166"},{"relevance":"0.845943","text":"equal sized fridge","$$hashKey":"object:167"},{"relevance":"0.698914","text":"fridge door","$$hashKey":"object:168"},{"relevance":"0.695015","text":"large fridge","$$hashKey":"object:169"},{"relevance":"0.638086","text":"possible browsing experience","$$hashKey":"object:170"},{"relevance":"0.631233","text":"Gorenje retro models","$$hashKey":"object:171"},{"relevance":"0.623239","text":"drawer freezer","$$hashKey":"object:172"},{"relevance":"0.622148","text":"Smeg Fab range","$$hashKey":"object:173"},{"relevance":"0.574032","text":"single temperature  models","$$hashKey":"object:174"},{"relevance":"0.570539","text":"multi temperature models","$$hashKey":"object:175"},{"relevance":"0.558732","text":"Appliance City home","$$hashKey":"object:176"},{"relevance":"0.558583","text":"Frost free models","$$hashKey":"object:177"},{"relevance":"0.553127","text":"independent temperature control","$$hashKey":"object:178"},{"relevance":"0.549289","text":"fixed water connection","$$hashKey":"object:179"},{"relevance":"0.544778","text":"optimum storage times","$$hashKey":"object:180"},{"relevance":"0.427596","text":"water dispenser","$$hashKey":"object:181"},{"relevance":"0.412823","text":"superb range","$$hashKey":"object:182"},{"relevance":"0.406709","text":"cookie settings","$$hashKey":"object:183"},{"relevance":"0.405079","text":"different models","$$hashKey":"object:184"},{"relevance":"0.404488","text":"privacy page","$$hashKey":"object:185"},{"relevance":"0.403733","text":"refrigeration products","$$hashKey":"object:186"},{"relevance":"0.395376","text":"popular links","$$hashKey":"object:187"},{"relevance":"0.393947","text":"left hand","$$hashKey":"object:188"},{"relevance":"0.389492","text":"humidity control","$$hashKey":"object:189"},{"relevance":"0.387612","text":"right place","$$hashKey":"object:190"},{"relevance":"0.386293","text":"electronic controls","$$hashKey":"object:191"},{"relevance":"0.385705","text":"great features","$$hashKey":"object:192"},{"relevance":"0.384147","text":"fan cooling","$$hashKey":"object:193"},{"relevance":"0.383915","text":"wine coolers","$$hashKey":"object:194"},{"relevance":"0.382445","text":"great selection","$$hashKey":"object:195"},{"relevance":"0.381578","text":"white wine","$$hashKey":"object:196"},{"relevance":"0.262427","text":"website","$$hashKey":"object:197"},{"relevance":"0.258213","text":"Liebherr","$$hashKey":"object:198"},{"relevance":"0.256557","text":"Miele","$$hashKey":"object:199"},{"relevance":"0.251518","text":"Fridges","$$hashKey":"object:200"},{"relevance":"0.251419","text":"Maytag","$$hashKey":"object:201"},{"relevance":"0.249063","text":"LG","$$hashKey":"object:202"},{"relevance":"0.247364","text":"Neff","$$hashKey":"object:203"},{"relevance":"0.246807","text":"champagnes","$$hashKey":"object:204"},{"relevance":"0.243717","text":"Bosch","$$hashKey":"object:205"},{"relevance":"0.243302","text":"Whirlpool","$$hashKey":"object:206"},{"relevance":"0.242469","text":"Samsung","$$hashKey":"object:207"},{"relevance":"0.240708","text":"split","$$hashKey":"object:208"},{"relevance":"0.236323","text":"cookies","$$hashKey":"object:209"},{"relevance":"0.2362","text":"parts","$$hashKey":"object:210"},{"relevance":"0.233612","text":"instructions","$$hashKey":"object:211"},{"relevance":"0.232187","text":"look","$$hashKey":"object:212"}]},"concepts":{"raw":[{"text":"Refrigerator","relevance":"0.98017","dbpedia":"http://dbpedia.org/resource/Refrigerator","freebase":"http://rdf.freebase.com/ns/m.040b_t","opencyc":"http://sw.opencyc.org/concept/Mx4rvViddJwpEbGdrcN5Y29ycA","$$hashKey":"object:263"},{"text":"Heat","relevance":"0.909387","dbpedia":"http://dbpedia.org/resource/Heat","freebase":"http://rdf.freebase.com/ns/m.03k2v","$$hashKey":"object:264"},{"text":"Absorption refrigerator","relevance":"0.729","dbpedia":"http://dbpedia.org/resource/Absorption_refrigerator","freebase":"http://rdf.freebase.com/ns/m.07029t","yago":"http://yago-knowledge.org/resource/Absorption_refrigerator","$$hashKey":"object:265"}]},"relations":{"raw":[{"subject":{"text":"This"},"action":{"text":"help","lemmatized":"help","verb":{"text":"help","tense":"future"}},"object":{"text":"provide you with the best possible browsing experience"}},{"subject":{"text":"This"},"action":{"text":"will help provide","lemmatized":"will help provide","verb":{"text":"provide","tense":"future"}},"object":{"text":"you"}},{"subject":{"text":"you"},"action":{"text":"browsing","lemmatized":"browse","verb":{"text":"browse","tense":"present"}},"object":{"text":"experience"}},{"subject":{"text":"'Accept'"},"action":{"text":"clicking","lemmatized":"click","verb":{"text":"click","tense":"present"}},"object":{"text":"you consent to the use of cookies on this website"}},{"subject":{"text":"You"},"action":{"text":"can change","lemmatized":"can change","verb":{"text":"change","tense":"future"}},"object":{"text":"your cookie settings"}},{"subject":{"text":"You"},"action":{"text":"to do","lemmatized":"to do","verb":{"text":"do","tense":"future"}},"object":{"text":"this"}},{"subject":{"text":"We"},"action":{"text":"stock","lemmatized":"stock","verb":{"text":"stock","tense":"present"}},"object":{"text":"a superb range of both freestanding and built in refrigeration products from brands such as Liebherr, Bosch, Miele and Neff"}},{"subject":{"text":"We"},"action":{"text":"specialise","lemmatized":"specialise","verb":{"text":"specialise","tense":"present"}},"object":{"text":"in American style fridge freezers by Samsung, LG, Whirlpool, Maytag, Smeg and many more"}},{"subject":{"text":"you"},"action":{"text":"are","lemmatized":"be","verb":{"text":"be","tense":"present"}},"object":{"text":"looking for a retro style fridge or fridge freezer"}},{"subject":{"text":"you"},"action":{"text":"looking","lemmatized":"look","verb":{"text":"look","tense":"present"}},"object":{"text":"for a retro style fridge or fridge freezer"}},{"subject":{"text":"you"},"action":{"text":"should take","lemmatized":"should take","verb":{"text":"take","tense":"future"}},"object":{"text":"a look at our Smeg Fab range and Gorenje retro models"}},{"subject":{"text":"You"},"action":{"text":"may be looking","lemmatized":"may be look","verb":{"text":"look","tense":"future"}},"object":{"text":"for a model"}},{"subject":{"text":"a dispenser"},"action":{"text":"require","lemmatized":"require","verb":{"text":"require","tense":"present"}},"object":{"text":"plumbing"}},{"subject":{"text":"some models"},"action":{"text":"do","lemmatized":"do","verb":{"text":"do","tense":"present"}},"object":{"text":"not need a water connection as they have a container inside the fridge door to supply the icemaker"}},{"subject":{"text":"some models"},"action":{"text":"need","lemmatized":"need","verb":{"text":"need","tense":"present","negated":"1"}},"object":{"text":"a water connection"}},{"subject":{"text":"they"},"action":{"text":"have","lemmatized":"have","verb":{"text":"have","tense":"present"}},"object":{"text":"a container inside the fridge door to supply the icemaker - this will require filling up manually"}},{"subject":{"text":"you"},"action":{"text":"are","lemmatized":"be","verb":{"text":"be","tense":"present"}}},{"subject":{"text":"a fridge freezer you've"},"action":{"text":"come","lemmatized":"come","verb":{"text":"come","tense":"past"}},"object":{"text":"to the right place"}},{"subject":{"text":"we"},"action":{"text":"have","lemmatized":"have","verb":{"text":"have","tense":"present"}},"object":{"text":"hundreds of different models available with some great features such as Biofresh, humidity control, fan cooling and electronic controls - all of which give you optimum storage times for your food and help reduce waste"}},{"subject":{"text":"optimum storage times for your food"},"action":{"text":"give","lemmatized":"give","verb":{"text":"give","tense":"present"}},"object":{"text":"you"}},{"subject":{"text":"you"},"action":{"text":"help","lemmatized":"help","verb":{"text":"help","tense":"present"}},"object":{"text":"reduce waste"}},{"subject":{"text":"We"},"action":{"text":"offer","lemmatized":"offer","verb":{"text":"offer","tense":"present"}},"object":{"text":"a great selection of wine coolers to suit your needs, single temperature models predominantly used for white wine and multi temperature models for storage of reds, whites and champagnes with independent temperature control"}},{"subject":{"text":"many sizes"},"action":{"text":"are","lemmatized":"be","verb":{"text":"be","tense":"present"}},"object":{"text":"available from 15cm to 60cm wide"}},{"subject":{"text":"The most popular integrated fridge freezers"},"action":{"text":"are","lemmatized":"be","verb":{"text":"be","tense":"present"}},"object":{"text":"70/30 split with a three drawer freezer at the bottom and a large fridge at the top"}},{"subject":{"text":"a 50/50 split"},"action":{"text":"offers","lemmatized":"offer","verb":{"text":"offer","tense":"present"}},"object":{"text":"a four drawer freezer"}},{"subject":{"text":"Frost free models"},"action":{"text":"are","lemmatized":"be","verb":{"text":"be","tense":"present"}},"object":{"text":"available in both configurations"}}]}}}];

    $scope.alchemy = function(i,callback) {
        page = $scope.page[i];

        _.each($scope.metrics, function(metric) {
            $scope.AlchemyApi(page.url, metric, function(res) {
              $scope.$apply(function(){
                $scope.page[i].data[res.metric] = {};
                $scope.page[i].data[res.metric].raw = res.data;
                if(Object.keys($scope.page[i].data).length == $scope.metrics.length) {
                  console.log("Finished analysing "+$scope.page[i].url);
                  if(callback) callback();
                }
              });
            });
        });
    }

    $scope.compare = function() {
      // Check that all pages have all metric data
      // _.each(new Array($scope.nPages), function(p,i) {
      //   $scope.alchemy(i,function() {
      //     if(i+1 == $scope.nPages) {
            onAlchemyDataLoaded();
        //   }
        // })
      // });

      // Find similarities and differences
      function onAlchemyDataLoaded() {
        console.log(JSON.stringify($scope.page));
        // console.log("Starting comparison analysis");
        _.each($scope.metrics, function(metric) {

          $scope.identical[metric.name] = "";
          $scope.page[0].data[metric.name].unique = "";

          // $scope.intersection = _.intersection(
          //                         $scope.page[0].data[metric.name],
          //                         $scope.page[1].data[metric.name]
          //                       );
          // $scope.difference = _.difference(
          //                         $scope.page[0].data[metric.name],
          //                         $scope.page[1].data[metric.name]
          //                       );
        })
      }
    }

    $scope.AlchemyApi = function(url, metric, callback) {
        $.ajax({
          url: 'https://access.alchemyapi.com/calls/'+metric.endpoint,
          dataType: 'jsonp',
          jsonp: 'jsonp',
          type: "post",
          data: {
            apikey: ALCHEMY_API_KEY,
            url: url,
            outputMode: 'json'
        },
          success: function(res) {
            if (res["status"] === "OK") {
              callback({metric: metric.name, data: res[metric.name]});
            }
            // else if (res["status"] === "ERROR") {
            //   //Do something bad
            // }
          },
          // error: function(jqxhr) {
          //   //console.log(jqxhr);
          // }
        });
    }
})
.filter('capitalize', function() {
  return function(input, all) {
    return (!!input) ? input.replace(/([^\W_]+[^\s-]*) */g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();}) : '';
  }
})
.filter('strToHSL', function() {
  return function(input) {
    return intToHSL(getHashCode(input));
  }
})
.filter('splitByCap', function() {
  return function(input) {
    return input.match(/([A-Z]?[^A-Z]*)/g).slice(0,-1).join(" ")
  }
})
.filter('normalised', function() {
  return function(input, min, max, newMin, newMax) {
    var ratio = (max > min) ? input/(max-min) : input/(min-max);
    var range = (max < min) ? (max - min) : (min - max);
    var newRange = (max < min) ? (newMax - newMin) : (newMin - newMax);
    var output;

    if(newMax > newMin)
    {
      output = newMax - (newRange * ratio);
    }
    else
    {
      output = newMin - (newRange * ratio);
    }
    console.log({
        "input": input,
        "before": [min,max],
        "after": [newMin,newMax],
        "ratio": ratio,
        "output": output
    });
    return output;
  }
})

function getHashCode(str) {
    var hash = 0;
    if (str.length == 0) return hash;
    for (var i = 0; i < str.length; i++) {
        hash = str.charCodeAt(i) + ((hash << 5) - hash);
        hash = hash & hash; // Convert to 32bit integer
    }
    return hash;
};
function intToHSL(int) {
    var shortened = int % 360;
    return "hsl(" + shortened + ",100%,30%)";
};